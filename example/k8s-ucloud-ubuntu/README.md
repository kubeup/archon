Kubernetes cluster with Ubuntu, kubeadm and flannel
===================================================

In this guide, we'll demonstrate how to bootstrap a Kubernetes cluster with
Ubuntu using [kubeadm].

Step 1
------

First, please follow the [installation guide] to install `archon-controller`
locally or into your Kubernetes cluster.


Step 2
------

Create a new namespace for this cluster:

```
kubectl create namespace ucloud-ubuntu
```

Step 3
------

Create a base64 encoded password for your machines and fill it in `k8s-passwd.yaml`. 
And create the passwd resource. This is used to ssh into your machines and start 
bootstrapping process.

```
echo -n YOUR_PASSWORD|base64 -
# Fill in passwd.yaml
kubectl create -f passwd.yaml --namespace=ucloud-ubuntu
```

Step 4
------

Modify `k8s-user.yaml`. Replace `YOUR_SSH_KEY` with your public key which will be
used for authentication with the server. And create the user resource.

```
kubectl create -f k8s-user.yaml --namespace=k8s-ubuntu
```

Step 5
------

(Optional) Create a vpc network in UCloud dashboard. Fill in the blanks in `k8s-net.yaml`.
Defaults will be used if this step is skipped.


Step 6
------

Create the network resource. Notice this needs to be created regardless of you have created
a new vpc or not.

```
kubectl create -f k8s-net.yaml --namespace=ucloud-ubuntu
```

Step 7
------

Modify `k8s-master.yaml`. Replace `YOUR_KUBEADM_TOKEN` with the token generated by `generate_token.py`
Create the instance group and let the `archon-controller` create the instance for you.
This will also install flannel to your cluster.

```
kubectl create -f k8s-master.yaml --namespace=ucloud-ubuntu
```

Step 9
-------

Update `k8s-node.yaml` with the master ip and token and create
it.

```
kubectl create -f k8s-node.yaml --namespace=ucloud-ubuntu
```


[installation guide]: https://github.com/kubeup/archon/blob/master/docs/installation_ucloud.md
